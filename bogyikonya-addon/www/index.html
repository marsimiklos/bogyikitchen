<!DOCTYPE html>
<html lang="hu">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Bogyi Konyha - Konyhai Nyilvรกntartรณ</title>
ย ย <script src="https://cdn.tailwindcss.com"></script>
ย ย <script>
ย ย ย ย tailwind.config = {
ย ย ย ย ย ย theme: {
ย ย ย ย ย ย ย ย extend: {
ย ย ย ย ย ย ย ย ย ย colors: {
ย ย ย ย ย ย ย ย ย ย ย ย 'moss-dark': '#4D584D', // Sรถtรฉt moha
ย ย ย ย ย ย ย ย ย ย ย ย 'moss-light': '#6F7F6F', // Vilรกgos moha
ย ย ย ย ย ย ย ย ย ย ย ย 'cream': '#F3F4F6', // Krรฉmszรญn
ย ย ย ย ย ย ย ย ย ย ย ย 'leaf': '#85A661', // Levรฉlzรถld
ย ย ย ย ย ย ย ย ย ย ย ย 'terracotta': '#CC7F6F', // Terrakotta (esetleg figyelmeztetรฉsre)
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย }
ย ย </script>
ย ย <style>
ย ย ย ย /* Egyedi gรถrgetลsรกv a modern bรถngรฉszลkhรถz */
ย ย ย ย ::-webkit-scrollbar {
ย ย ย ย ย ย width: 8px;
ย ย ย ย }

ย ย ย ย ::-webkit-scrollbar-track {
ย ย ย ย ย ย background: #F3F4F6;
ย ย ย ย }

ย ย ย ย ::-webkit-scrollbar-thumb {
ย ย ย ย ย ย background: #85A661;
ย ย ย ย ย ย border-radius: 4px;
ย ย ย ย }

ย ย ย ย ::-webkit-scrollbar-thumb:hover {
ย ย ย ย ย ย background: #6F7F6F;
ย ย ย ย }

ย ย ย ย /* Modal animรกciรณ */
ย ย ย ย .modal-enter-active, .modal-leave-active {
ย ย ย ย ย ย transition: opacity 0.3s ease;
ย ย ย ย }
ย ย ย ย .modal-enter-from, .modal-leave-to {
ย ย ย ย ย ย opacity: 0;
ย ย ย ย }
ย ย </style>
</head>
<body class="bg-cream font-sans flex flex-col min-h-screen">

ย ย <header class="bg-moss-dark text-white shadow-xl">
ย ย ย ย <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
ย ย ย ย ย ย <h1 class="text-3xl font-bold">Bogyi Konyha ๐ฝ๏ธ</h1>
ย ย ย ย ย ย <div id="auth-info" class="text-sm bg-moss-light px-3 py-1 rounded-full">
ย ย ย ย ย ย ย ย Helyi tรกrolรกs (Local JSON)
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย ย ยย
ย ย ย ย <nav class="bg-moss-light shadow-inner">
ย ย ย ย ย ย <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
ย ย ย ย ย ย ย ย <div class="flex space-x-4">
ย ย ย ย ย ย ย ย ย ย <button id="tab-preparedMeals" onclick="switchTab('preparedMeals')" class="tab-button text-cream px-3 py-2 text-sm font-medium border-b-2 border-transparent hover:border-leaf transition duration-150">Kรฉszรฉtelek</button>
ย ย ย ย ย ย ย ย ย ย <button id="tab-pantry" onclick="switchTab('pantry')" class="tab-button text-cream px-3 py-2 text-sm font-medium border-b-2 border-transparent hover:border-leaf transition duration-150">Kamra</button>
ย ย ย ย ย ย ย ย ย ย <button id="tab-shoppingList" onclick="switchTab('shoppingList')" class="tab-button text-cream px-3 py-2 text-sm font-medium border-b-2 border-transparent hover:border-leaf transition duration-150">Bevรกsรกrlรณlista</button>
ย ย ย ย ย ย ย ย ย ย <button id="tab-recipes" onclick="switchTab('recipes')" class="tab-button text-cream px-3 py-2 text-sm font-medium border-b-2 border-transparent hover:border-leaf transition duration-150">Recepteskรถnyv</button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </nav>
ย ย </header>

ย ย <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 w-full">
ย ย ย ย <div id="tab-content" class="min-h-[60vh] bg-white p-6 rounded-lg shadow-lg">
ย ย ย ย ย ย </div>
ย ย </main>

ย ย <div id="alert-container" class="fixed top-2 right-2 z-50 space-y-2">
ย ย ย ย </div>

ย ย <div id="modal-container" class="fixed inset-0 z-40 hidden">
ย ย ย ย </div>

<script type="module">
ย ย // Nincs tรถbbรฉ Firebase inicializรกlรกs รฉs auth.
ย ย // A Flask szerver (app.py) kezeli a helyi adattรกrolรกst.
ย ยย
ย ย // --- MรDOSรTVA AZ INGRESS TรMOGATรSHOZ ---
ย ย // Az Ingress รบtvonalat (base path) a Flask server (app.py) injektรกlta 
ย ย // a window.HASS_API_BASE_PATH vรกltozรณba. Ezt kell hasznรกlnunk minden API hรญvรกshoz.
ย ย const BASE_PATH = window.HASS_API_BASE_PATH || '/';
ย ย const BASE_API_URL = `${BASE_PATH}api/`;
ย ย // --- MรDOSรTรS VรGE ---

ย ย let isAuthReady = true; // Mindig kรฉsz, nincs hitelesรญtรฉs
ย ย let currentTab = 'preparedMeals';
ย ย let isInitialLoad = true;

ย ย // Lokรกlis adattรกrolรกs
ย ย let state = {
ย ย ย ย preparedMeals: [],
ย ย ย ย pantry: [],
ย ย ย ย shoppingList: [],
ย ย ย ย recipes: [],
ย ย ย ย pantryNames: new Set(), // Gyors keresรฉshez, kisbetลฑsรญtve
ย ย };

ย ย let recipeFilters = {
ย ย ย ย isCookableFilterActive: false,
ย ย ย ย activeTags: new Set(),
ย ย ย ย allAvailableTags: new Set(),
ย ย ย ย currentSearch: ''
ย ย };
ย ยย
ย ย // Auth info eltรกvolรญtรกsa (nincs auth)
ย ย document.addEventListener('DOMContentLoaded', () => {
ย ย ย ย const authInfo = document.getElementById('auth-info');
ย ย ย ย if (authInfo) {
ย ย ย ย ย ย authInfo.textContent = 'Helyi tรกrolรกs (Local JSON)';
ย ย ย ย }
ย ย });

ย ย // --- HELYI ADATKEZELรS (API HรVรSOK) ---

ย ย // Segรฉdfรผggvรฉny: Dรกtum formรกzรกsa
ย ย const formatDate = (timestamp) => {
ย ย ย ย if (!timestamp) return 'N/A';
ย ย ย ย // A Flask ISO stringet ad vissza. Ezt dolgozzuk fel.
ย ย ย ย const date = new Date(timestamp);
ย ย ย ย return date.toLocaleDateString('hu-HU', { year: 'numeric', month: 'short', day: 'numeric' });
ย ย };

ย ย // Segรฉdfรผggvรฉny: API hรญvรกs (CRUD)
ย ย async function apiCall(method, collection, data = null, id = null) {
ย ย ย ย let url = BASE_API_URL + collection;
ย ย ย ย if (id) {
ย ย ย ย ย ย url += '/' + id;
ย ย ย ย }

ย ย ย ย const options = {
ย ย ย ย ย ย method: method,
ย ย ย ย ย ย headers: {
ย ย ย ย ย ย ย ย 'Content-Type': 'application/json'
ย ย ย ย ย ย }
ย ย ย ย };

ย ย ย ย if (data) {
ย ย ย ย ย ย options.body = JSON.stringify(data);
ย ย ย ย }

ย ย ย ย try {
ย ย ย ย ย ย const response = await fetch(url, options);
ย ย ย ย ย ย if (!response.ok) {
ย ย ย ย ย ย ย ย throw new Error(`API hiba: ${response.status} ${response.statusText}`);
ย ย ย ย ย ย }
ย ย ย ย ย ย // A DELETE hรญvรกs lehet, hogy nem ad vissza JSON-t (204 No Content), ezรฉrt ellenลrizzรผk
ย ย ย ย ย ย if (response.status !== 204 && response.headers.get("content-length") !== "0") {
ย ย ย ย ย ย ย ย return await response.json();
ย ย ย ย ย ย }
ย ย ย ย ย ย return { success: true };
ย ย ย ย } catch (e) {
ย ย ย ย ย ย console.error("Hiba az API hรญvรกsban:", e);
ย ย ย ย ย ย showAlert(`Hiba a kommunikรกciรณban a helyi szerverrel: ${e.message}`, 'error');
ย ย ย ย ย ย return { error: e.message };
ย ย ย ย }
ย ย }


ย ย // --- Fล ADATBETรLTล รS RENDERELล FรGGVรNY ---
ย ยย
ย ย async function loadAndRenderData() {
ย ย ย ย if (!isAuthReady) return;

ย ย ย ย try {
ย ย ย ย ย ย const collections = ['preparedMeals', 'pantry', 'shoppingList', 'recipes'];
ย ย ย ย ย ยย
ย ย ย ย ย ย const results = await Promise.all(collections.map(c => apiCall('GET', c)));
ย ย ย ย ย ยย
ย ย ย ย ย ย if (results.some(r => r.error)) {
ย ย ย ย ย ย ย ย throw new Error("Hiba az adatok lekรฉrdezรฉsekor.");
ย ย ย ย ย ย }

ย ย ย ย ย ย // Az id-k รฉs a dรกtumok kezelรฉse: a Python backend mรกr az id mezลvel รฉs ISO string dรกtumokkal adja vissza.
ย ย ย ย ย ย state.preparedMeals = results[0];
ย ย ย ย ย ย state.pantry = results[1].map(item => ({ย
ย ย ย ย ย ย ย ย ...item,ย
ย ย ย ย ย ย ย ย // A Python backend mรกr kisbetลฑsรญti a nevet, de az id is fontos
ย ย ย ย ย ย ย ย name: item.name.toLowerCase().trim()ย
ย ย ย ย ย ย }));
ย ย ย ย ย ย state.shoppingList = results[2];
ย ย ย ย ย ย state.recipes = results[3];

ย ย ย ย ย ย // Gyors keresรฉsi kรฉszlet frissรญtรฉse
ย ย ย ย ย ย state.pantryNames = new Set(state.pantry.map(item => item.name));
ย ย ย ย ย ยย
ย ย ย ย ย ย // Recept szลฑrลk tagjainak frissรญtรฉse, hogy a friss adatokon alapuljon
ย ย ย ย ย ย recipeFilters.allAvailableTags = new Set();
ย ย ย ย ย ย state.recipes.forEach(r => r.tags.forEach(tag => recipeFilters.allAvailableTags.add(tag)));

ย ย ย ย ย ย if (isInitialLoad) {
ย ย ย ย ย ย ย ย switchTab(currentTab);
ย ย ย ย ย ย ย ย isInitialLoad = false;
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย // Csak a jelenlegi nรฉzet frissรญtรฉse
ย ย ย ย ย ย ย ย switch (currentTab) {
ย ย ย ย ย ย ย ย ย ย case 'preparedMeals': renderPreparedMeals(); break;
ย ย ย ย ย ย ย ย ย ย case 'pantry': renderPantry(); break;
ย ย ย ย ย ย ย ย ย ย case 'shoppingList': renderShoppingList(); break;
ย ย ย ย ย ย ย ย ย ย case 'recipes': renderRecipes(); break;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย } catch (e) {
ย ย ย ย ย ย console.error("Hiba a teljes adatbetรถltรฉskor:", e);
ย ย ย ย ย ย const contentDiv = document.getElementById('tab-content');
ย ย ย ย ย ย contentDiv.innerHTML = `<p class="text-center text-red-500 py-10">Kritikus hiba: Nem sikerรผlt a helyi API-hoz csatlakozni. Kรฉrlek ellenลrizd az add-on naplรณit!</p>`;
ย ย ย ย }
ย ย }

ย ย // Segรฉdfรผggvรฉny: Alert รผzenet megjelenรญtรฉse
ย ย function showAlert(message, type = 'success') {
ย ย ย ย const container = document.getElementById('alert-container');
ย ย ย ย
ย ย ย ย let color;

ย ย ย ย if (type === 'error') {
ย ย ย ย ย ย color = 'bg-red-500';
ย ย ย ย } else { // 'success'
ย ย ย ย ย ย color = 'bg-moss-light';
ย ย ย ย }

ย ย ย ย const alertDiv = document.createElement('div');
ย ย ย ย alertDiv.className = `p-4 mb-2 rounded-lg shadow-xl text-white max-w-sm ${color} transition-opacity duration-300 opacity-0`;
ย ย ย ย
ย ย ย ย alertDiv.innerHTML = `<span class="font-semibold">${message}</span>`;
ย ย ย ย
ย ย ย ย container.appendChild(alertDiv);
ย ย ย ย
ย ย ย ย // Animรกciรณ
ย ย ย ย setTimeout(() => alertDiv.classList.remove('opacity-0'), 10);
ย ย ย ย setTimeout(() => {
ย ย ย ย ย ย alertDiv.classList.add('opacity-0');
ย ย ย ย ย ย alertDiv.addEventListener('transitionend', () => alertDiv.remove());
ย ย ย ย }, 3000);
ย ย }

ย ย // --- CRUD Mลฑveletek (API HรVรSOK) ---

ย ย // Kรฉszรฉtelek (Prepared Meals)
ย ย window.addPreparedMeal = async function(name, expiryDate, requiresSide) {
ย ย ย ย const result = await apiCall('POST', 'preparedMeals', {
ย ย ย ย ย ย name,
ย ย ย ย ย ย // A dรกtumot ISO stringkรฉnt kรผldjรผk
ย ย ย ย ย ย expiryDate: expiryDate ? new Date(expiryDate).toISOString() : null,
ย ย ย ย ย ย requiresSide,
ย ย ย ย });

ย ย ย ย if (result.success) {
ย ย ย ย ย ย showAlert('Kรฉszรฉtel sikeresen hozzรกadva!');
ย ย ย ย ย ย loadAndRenderData(); // Adatok frissรญtรฉse
ย ย ย ย }
ย ย }

ย ย // Kรฉszรฉtel tรถrlรฉse/elfogyasztรกsa
ย ย window.deletePreparedMeal = async function(id) {
ย ย ย ย const result = await apiCall('DELETE', 'preparedMeals', null, id);
ย ย ย ย if (result.success) {
ย ย ย ย ย ย showAlert('Elfogyasztva!');
ย ย ย ย ย ย loadAndRenderData(); // Adatok frissรญtรฉse
ย ย ย ย }
ย ย }

ย ย // Kamra (Pantry)
ย ย window.addPantryItem = async function(name, expiryDate, shouldRestock, showAlertOnSuccess = true) {
ย ย ย ย const result = await apiCall('POST', 'pantry', {
ย ย ย ย ย ย name: name.trim(),
ย ย ย ย ย ย expiryDate: expiryDate ? new Date(expiryDate).toISOString() : null,
ย ย ย ย ย ย shouldRestock,
ย ย ย ย });

ย ย ย ย if (result.success) {
ย ย ย ย ย ย if (showAlertOnSuccess) {
ย ย ย ย ย ย ย ย showAlert('Kamra tรฉtel sikeresen hozzรกadva!');
ย ย ย ย ย ย }
ย ย ย ย ย ย loadAndRenderData(); // Adatok frissรญtรฉse
ย ย ย ย }
ย ย }

ย ย // Kamra tรฉtel elfogyott/tรถrlรฉse -> Bevรกsรกrlรณlistรกra kerรผl
ย ย window.markPantryItemUsedUp = async function(id, name, shouldRestock) {
ย ย ย ย // 1. Kamra tรฉtel tรถrlรฉse
ย ย ย ย const deleteResult = await apiCall('DELETE', 'pantry', null, id);

ย ย ย ย if (deleteResult.success) {
ย ย ย ย ย ย if (shouldRestock) {
ย ย ย ย ย ย ย ย // 2. Bevรกsรกrlรณlistรกra rakรกs
ย ย ย ย ย ย ย ย const addResult = await apiCall('POST', 'shoppingList', {
ย ย ย ย ย ย ย ย ย ย name,
ย ย ย ย ย ย ย ย ย ย isBought: false,
ย ย ย ย ย ย ย ย ย ย source: 'pantry_restock'
ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย if (addResult.success) {
ย ย ย ย ย ย ย ย ย ย showAlert(`${name} elfogyott รฉs automatikusan hozzรกadva a Bevรกsรกrlรณlistรกhoz!`);
ย ย ย ย ย ย ย ย ย ย loadAndRenderData(); // Adatok frissรญtรฉse
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย showAlert(`${name} elfogyott!`);
ย ย ย ย ย ย ย ย loadAndRenderData(); // Adatok frissรญtรฉse
ย ย ย ย ย ย }
ย ย ย ย }
ย ย }

ย ย // Bevรกsรกrlรณlista
ย ย window.addShoppingListItem = async function(name) {
ย ย ย ย const result = await apiCall('POST', 'shoppingList', {
ย ย ย ย ย ย name: name.trim(),
ย ย ย ย ย ย isBought: false,
ย ย ย ย ย ย source: 'manual'
ย ย ย ย });

ย ย ย ย if (result.success) {
ย ย ย ย ย ย showAlert(`${name} hozzรกadva a Bevรกsรกrlรณlistรกhoz!`);
ย ย ย ย ย ย loadAndRenderData(); // Adatok frissรญtรฉse
ย ย ย ย }
ย ย }
ย ย
ย ย window.deleteShoppingListItem = async function(id, showAlertOnSuccess = true) {
ย ย ย ย const result = await apiCall('DELETE', 'shoppingList', null, id);
ย ย ย ยย
ย ย ย ย if (result.success) {
ย ย ย ย ย ย if (showAlertOnSuccess) {
ย ย ย ย ย ย ย ย showAlert('Tรฉtel tรถrรถlve a Bevรกsรกrlรณlistรกrรณl!');
ย ย ย ย ย ย }
ย ย ย ย ย ย loadAndRenderData(); // Adatok frissรญtรฉse
ย ย ย ย }
ย ย }

ย ย window.markShoppingItemBought = async function(id, name) {
ย ย ย ย const result = await apiCall('DELETE', 'shoppingList', null, id);
ย ย ย ย if (result.success) {
ย ย ย ย ย ย // Mivel megvettรผk, most hozzรกadjuk a kamrรกhoz
ย ย ย ย ย ย // Hasznรกljuk a mรกr lรฉtezล addPantryItem funkciรณt. Nincs lejรกrati dรกtum รฉs nincs szรผksรฉg restock-ra, mivel most vettรผk meg.
ย ย ย ย ย ย // A false az utolsรณ paramรฉter, ami jelzi, hogy ne jelenjen meg alert.
ย ย ย ย ย ย window.addPantryItem(name, null, false, false);ย
ย ย ย ย ย ย showAlert(`${name} megvรกsรกrolva รฉs hozzรกadva a Kamrรกhoz!`);
ย ย ย ย ย ย // loadAndRenderData-t mรกr az addPantryItem hรญvja
ย ย ย ย }
ย ย }

ย ย // Recepteskรถnyv
ย ย window.addRecipe = async function(name, ingredients, optionalIngredients, instructions, tags) {
ย ย ย ย const result = await apiCall('POST', 'recipes', {
ย ย ย ย ย ย name: name.trim(),
ย ย ย ย ย ย ingredients,ย
ย ย ย ย ย ย optionalIngredients,ย
ย ย ย ย ย ย instructions,
ย ย ย ย ย ย tags,ย
ย ย ย ย });

ย ย ย ย if (result.success) {
ย ย ย ย ย ย showAlert(`${name} recept sikeresen hozzรกadva!`);
ย ย ย ย ย ย loadAndRenderData(); // Adatok frissรญtรฉse
ย ย ย ย }
ย ย }

ย ย window.deleteRecipe = async function(id) {
ย ย ย ย const result = await apiCall('DELETE', 'recipes', null, id);

ย ย ย ย if (result.success) {
ย ย ย ย ย ย showAlert('Recept tรถrรถlve!');
ย ย ย ย ย ย loadAndRenderData(); // Adatok frissรญtรฉse
ย ย ย ย }
ย ย }

ย ย // --- UI/RENDER FรGGVรNYEK ---

ย ย function switchTab(tabName) {
ย ย ย ย currentTab = tabName;
ย ย ย ย const contentDiv = document.getElementById('tab-content');
ย ย ย ย const tabButtons = document.querySelectorAll('.tab-button');

ย ย ย ย tabButtons.forEach(btn => {
ย ย ย ย ย ย btn.classList.remove('border-leaf', 'font-bold');
ย ย ย ย ย ย btn.classList.add('border-transparent');
ย ย ย ย });

ย ย ย ย document.getElementById(`tab-${tabName}`).classList.add('border-leaf', 'font-bold');

ย ย ย ย contentDiv.innerHTML = '<div class="text-center py-10 text-moss-light">Adatok betรถltรฉse...</div>';

ย ย ย ย switch (tabName) {
ย ย ย ย ย ย case 'preparedMeals': renderPreparedMeals(); break;
ย ย ย ย ย ย case 'pantry': renderPantry(); break;
ย ย ย ย ย ย case 'shoppingList': renderShoppingList(); break;
ย ย ย ย ย ย case 'recipes': renderRecipes(); break;
ย ย ย ย ย ย default: contentDiv.innerHTML = '<p class="text-red-500">Hiba: Ismeretlen fรผl.</p>';
ย ย ย ย }
ย ย }

ย ย // Dรกtum รกllapot jelzล
ย ย function getExpiryStatus(expiryDate) {
ย ย ย ย if (!expiryDate) return { color: 'text-gray-500', label: 'N/A' };
ย ย ย ย // Az ISO string konvertรกlรกsa Date objektummรก, hogy a szรกmรญtรกs mลฑkรถdjรถn.
ย ย ย ย const date = new Date(expiryDate);
ย ย ย ย const diffDays = Math.ceil((date.getTime() - Date.now()) / (1000 * 60 * 60 * 24));
ย ย ย ย if (diffDays < 0) return { color: 'bg-red-500 text-white', label: 'LEJรRT!' };
ย ย ย ย if (diffDays <= 3) return { color: 'bg-yellow-400 text-gray-800', label: `Lejรกr: ${diffDays} nap` };
ย ย ย ย return { color: 'text-gray-500', label: `${diffDays} nap` };
ย ย }


ย ย function renderPreparedMeals() {
ย ย ย ย const contentDiv = document.getElementById('tab-content');
ย ย ย ย contentDiv.innerHTML = `
ย ย ย ย ย ย <div class="flex justify-between items-center mb-6">
ย ย ย ย ย ย ย ย <h2 class="text-2xl font-semibold text-moss-dark">Kรฉszรฉtelek รฉs maradรฉkok (${state.preparedMeals.length} db)</h2>
ย ย ย ย ย ย ย ย <button onclick="showPreparedMealModal()" class="bg-leaf hover:bg-moss-light text-white font-bold py-2 px-4 rounded transition duration-150">
ย ย ย ย ย ย ย ย ย ย + รj Kรฉszรฉtel
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
ย ย ย ย ย ย ย ย ${state.preparedMeals.length === 0 ? '<p class="text-gray-500 col-span-full text-center">Nincs kรฉszรฉtel a listรกban.</p>' : state.preparedMeals.sort((a, b) => new Date(a.expiryDate) - new Date(b.expiryDate)).map(item => {
ย ย ย ย ย ย ย ย ย ย const status = getExpiryStatus(item.expiryDate);
ย ย ย ย ย ย ย ย ย ย return `
ย ย ย ย ย ย ย ย ย ย ย ย <div class="bg-cream p-4 rounded-lg shadow-md border-t-4 border-leaf flex flex-col justify-between">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h3 class="text-xl font-bold text-moss-dark mb-2">${item.name}</h3>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="text-sm text-gray-600 flex items-center mb-1">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="font-semibold mr-1">Lejรกrat:</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="px-2 py-0.5 text-xs rounded-full ${status.color}">${status.label}</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="text-sm text-gray-600 mb-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="font-semibold">Kรถret igรฉny:</span> ${item.requiresSide ? 'Igen' : 'Nem'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="window.deletePreparedMeal('${item.id}')" class="bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded text-sm transition duration-150 mt-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Elfogyasztva / Tรถrlรฉs
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย }).join('')}
ย ย ย ย ย ย </div>
ย ย ย ย `;
ย ย }

ย ย function renderPantry() {
ย ย ย ย const contentDiv = document.getElementById('tab-content');
ย ย ย ย const now = Date.now();
ย ย ย ย const expiredItems = state.pantry.filter(item => item.expiryDate && new Date(item.expiryDate).getTime() < now);
ย ย ย ย const expiringSoonItems = state.pantry.filter(item => item.expiryDate && new Date(item.expiryDate).getTime() >= now && new Date(item.expiryDate).getTime() - now <= (3 * 24 * 60 * 60 * 1000));
ย ย ย ย const otherItems = state.pantry.filter(item => expiredItems.indexOf(item) === -1 && expiringSoonItems.indexOf(item) === -1);

ย ย ย ย const renderItems = (items, title, color, isExpired = false) => {
ย ย ย ย ย ย if (items.length === 0) return '';
ย ย ย ย ย ย return `
ย ย ย ย ย ย ย ย <h3 class="text-xl font-semibold text-moss-dark mt-6 mb-3 border-b pb-1 text-${color}-600">${title} (${items.length} db)</h3>
ย ย ย ย ย ย ย ย <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
ย ย ย ย ย ย ย ย ย ย ${items.map(item => {
ย ย ย ย ย ย ย ย ย ย ย ย const status = getExpiryStatus(item.expiryDate);
ย ย ย ย ย ย ย ย ย ย ย ย return `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="bg-cream p-3 rounded-lg shadow-md border-l-4 border-${color}-400 flex flex-col justify-between">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex justify-between items-start">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h4 class="text-lg font-bold text-moss-dark">${item.name.charAt(0).toUpperCase() + item.name.slice(1)}</h4>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${item.shouldRestock ? '<span title="Utรกnpรณtlรกs szรผksรฉges" class="text-leaf text-xl">๐</span>' : ''}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="text-xs text-gray-600 mb-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="font-semibold mr-1">Lejรกrati dรกtum:</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="px-2 py-0.5 text-xs rounded-full ${status.color}">${status.label}</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="window.markPantryItemUsedUp('${item.id}', '${item.name}', ${item.shouldRestock})" class="bg-terracotta hover:bg-red-500 text-white font-bold py-1 px-3 rounded text-sm transition duration-150 mt-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Elfogyott / Tรถrlรฉs
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย ย ย }).join('')}
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `;
ย ย ย ย };

ย ย ย ย contentDiv.innerHTML = `
ย ย ย ย ย ย <div class="flex justify-between items-center mb-6">
ย ย ย ย ย ย ย ย <h2 class="text-2xl font-semibold text-moss-dark">Kamra nyilvรกntartรณ (${state.pantry.length} db)</h2>
ย ย ย ย ย ย ย ย <button onclick="showPantryModal()" class="bg-leaf hover:bg-moss-light text-white font-bold py-2 px-4 rounded transition duration-150">
ย ย ย ย ย ย ย ย ย ย + รj Kamra tรฉtel
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย ${renderItems(expiredItems, 'Lejรกrt Tรฉtelek', 'red', true)}
ย ย ย ย ย ย ${renderItems(expiringSoonItems, 'Hamarosan Lejรกrรณ Tรฉtelek (3 napon belรผl)', 'yellow')}
ย ย ย ย ย ย ${renderItems(otherItems.sort((a, b) => {
ย ย ย ย ย ย ย ย const dateA = a.expiryDate ? new Date(a.expiryDate) : new Date(8640000000000000); // Max Date for null
ย ย ย ย ย ย ย ย const dateB = b.expiryDate ? new Date(b.expiryDate) : new Date(8640000000000000);
ย ย ย ย ย ย ย ย return dateA - dateB;
ย ย ย ย ย ย }), 'Egyรฉb Tรฉtelek', 'leaf')}
ย ย ย ย `;
ย ย }

ย ย function renderShoppingList() {
ย ย ย ย const contentDiv = document.getElementById('tab-content');
ย ย ย ยย
ย ย ย ย contentDiv.innerHTML = `
ย ย ย ย ย ย <div class="flex justify-between items-center mb-6">
ย ย ย ย ย ย ย ย <h2 class="text-2xl font-semibold text-moss-dark">Bevรกsรกrlรณlista (${state.shoppingList.length} db)</h2>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div class="mb-6 flex space-x-2">
ย ย ย ย ย ย ย ย <input type="text" id="new-shopping-item" placeholder="รj tรฉtel hozzรกadรกsa (pl. tej, kenyรฉr)" class="flex-grow p-2 border border-gray-300 rounded focus:ring-leaf focus:border-leaf">
ย ย ย ย ย ย ย ย <button onclick="handleNewShoppingItem()" class="bg-leaf hover:bg-moss-light text-white font-bold py-2 px-4 rounded transition duration-150">
ย ย ย ย ย ย ย ย ย ย Hozzรกad
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
ย ย ย ย ย ย ย ย ${state.shoppingList.length === 0 ? '<p class="text-gray-500 col-span-full text-center">Nincs tรฉtel a bevรกsรกrlรณlistรกn.</p>' : state.shoppingList.map(item => `
ย ย ย ย ย ย ย ย ย ย <div class="bg-cream p-4 rounded-lg shadow-md border-l-4 border-leaf flex items-center justify-between">
ย ย ย ย ย ย ย ย ย ย ย ย <span class="text-lg font-medium text-moss-dark">${item.name.charAt(0).toUpperCase() + item.name.slice(1)}</span>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex space-x-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="window.markShoppingItemBought('${item.id}', '${item.name}')" title="Megvรกsรกrolva, mehet a kamrรกba" class="text-leaf hover:text-moss-dark transition duration-150">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โ๏ธ
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="window.deleteShoppingListItem('${item.id}')" title="Tรถrlรฉs" class="text-red-500 hover:text-red-700 transition duration-150">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โ
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย `).join('')}
ย ย ย ย ย ย </div>
ย ย ย ย `;
ย ย }

ย ย function renderRecipes() {
ย ย ย ย const contentDiv = document.getElementById('tab-content');
ย ย ย ยย
ย ย ย ย const filterPills = Array.from(recipeFilters.allAvailableTags).sort().map(tag => {
ย ย ย ย ย ย const isActive = recipeFilters.activeTags.has(tag);
ย ย ย ย ย ย return `
ย ย ย ย ย ย ย ย <button onclick="toggleTagFilter('${tag}')" class="tag-pill ${isActive ? 'bg-leaf text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'} px-3 py-1 text-sm rounded-full transition duration-150 mr-2 mb-2">
ย ย ย ย ย ย ย ย ย ย ${tag}
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย `;
ย ย ย ย }).join('');

ย ย ย ย const filteredRecipes = state.recipes.filter(recipe => {
ย ย ย ย ย ย // 1. Tag szลฑrรฉs
ย ย ย ย ย ย if (recipeFilters.activeTags.size > 0) {
ย ย ย ย ย ย ย ย const hasAllTags = Array.from(recipeFilters.activeTags).every(tag => recipe.tags.includes(tag));
ย ย ย ย ย ย ย ย if (!hasAllTags) return false;
ย ย ย ย ย ย }

ย ย ย ย ย ย // 2. 'Fลzhetล' szลฑrรฉs
ย ย ย ย ย ย if (recipeFilters.isCookableFilterActive) {
ย ย ย ย ย ย ย ย // Ellenลrizzรผk, hogy minden kรถtelezล รถsszetevล megvan-e a kamrรกban
ย ย ย ย ย ย ย ย const isCookable = recipe.ingredients.every(ing => state.pantryNames.has(ing.toLowerCase().trim()));
ย ย ย ย ย ย ย ย if (!isCookable) return false;
ย ย ย ย ย ย }

ย ย ย ย ย ย // 3. Keresรฉs
ย ย ย ย ย ย if (recipeFilters.currentSearch) {
ย ย ย ย ย ย ย ย const searchLower = recipeFilters.currentSearch.toLowerCase();
ย ย ย ย ย ย ย ย if (!recipe.name.toLowerCase().includes(searchLower) &&ย
ย ย ย ย ย ย ย ย ย ย !recipe.ingredients.some(ing => ing.toLowerCase().includes(searchLower)) &&
ย ย ย ย ย ย ย ย ย ย !recipe.tags.some(tag => tag.toLowerCase().includes(searchLower))) {
ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย return true;
ย ย ย ย });

ย ย ย ย contentDiv.innerHTML = `
ย ย ย ย ย ย <div class="flex justify-between items-center mb-6">
ย ย ย ย ย ย ย ย <h2 class="text-2xl font-semibold text-moss-dark">Recepteskรถnyv (${filteredRecipes.length} / ${state.recipes.length} recept)</h2>
ย ย ย ย ย ย ย ย <button onclick="showRecipeModal()" class="bg-leaf hover:bg-moss-light text-white font-bold py-2 px-4 rounded transition duration-150">
ย ย ย ย ย ย ย ย ย ย + รj Recept
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="mb-6 bg-cream p-4 rounded-lg shadow-inner">
ย ย ย ย ย ย ย ย <div class="flex space-x-4 mb-4 items-center">
ย ย ย ย ย ย ย ย ย ย <input type="text" id="recipe-search" placeholder="Keresรฉs nรฉv, รถsszetevล, vagy tag szerint..." value="${recipeFilters.currentSearch}"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ยoninput="recipeFilters.currentSearch = this.value; renderRecipes();"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ยclass="flex-grow p-2 border border-gray-300 rounded focus:ring-leaf focus:border-leaf">
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <button onclick="toggleCookableFilter()"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย class="${recipeFilters.isCookableFilterActive ? 'bg-leaf' : 'bg-gray-300'} hover:opacity-80 text-white font-bold py-2 px-4 rounded transition duration-150 flex items-center">
ย ย ย ย ย ย ย ย ย ย ย ย ${recipeFilters.isCookableFilterActive ? 'โ Csak a Fลzhetลek' : 'Fลzhetลek szลฑrรฉse'}
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย <div class="border-t pt-3 mt-3">
ย ย ย ย ย ย ย ย ย ย <p class="text-sm font-semibold text-moss-dark mb-2">Tag-ek szลฑrรฉse:</p>
ย ย ย ย ย ย ย ย ย ย ${filterPills || '<p class="text-xs text-gray-500">Nincs elรฉrhetล tag.</p>'}
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
ย ย ย ย ย ย ย ย ${filteredRecipes.length === 0 ? '<p class="text-gray-500 col-span-full text-center">Nincs a szลฑrลknek megfelelล recept.</p>' : filteredRecipes.map(recipe => {
ย ย ย ย ย ย ย ย ย ย // Kรผlรถn ellenลrzรฉs a recept kรกrtyรกn
ย ย ย ย ย ย ย ย ย ย const isCookable = recipe.ingredients.every(ing => state.pantryNames.has(ing.toLowerCase().trim()));
ย ย ย ย ย ย ย ย ย ย const cookableIndicator = isCookable ?ย
ย ย ย ย ย ย ย ย ย ย ย ย '<span class="text-leaf font-bold">โ Fลzhetล (Megvan minden)</span>' :ย
ย ย ย ย ย ย ย ย ย ย ย ย '<span class="text-terracotta font-bold">โ Hiรกnyos (Vรกsรกrolni kell)</span>';

ย ย ย ย ย ย ย ย ย ย return `
ย ย ย ย ย ย ย ย ย ย ย ย <div class="bg-cream p-5 rounded-lg shadow-md border-t-4 ${isCookable ? 'border-leaf' : 'border-terracotta'} flex flex-col">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h3 class="text-2xl font-bold text-moss-dark mb-2">${recipe.name}</h3>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="text-sm mb-3">${cookableIndicator}</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="mb-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="font-semibold text-moss-dark">รsszetevลk:</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <ul class="list-disc list-inside text-gray-600 text-sm pl-2 max-h-20 overflow-y-auto">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${recipe.ingredients.map(ing => {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย const hasIt = state.pantryNames.has(ing.toLowerCase().trim());
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย return `<li class="${hasIt ? 'text-green-600' : 'text-red-500'}">${ing}</li>`;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }).join('')}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${recipe.optionalIngredients && recipe.optionalIngredients.length > 0 ?ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย recipe.optionalIngredients.map(ing => `<li class="text-gray-500 italic">(${ing} - opcionรกlis)</li>`).join('') : ''}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </ul>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="mb-3 flex-grow">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="font-semibold text-moss-dark">Utasรญtรกs:</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="text-gray-600 text-sm overflow-hidden h-12">${recipe.instructions.substring(0, 100)}${recipe.instructions.length > 100 ? '...' : ''}</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="mt-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${recipe.tags.map(tag => `<span class="bg-moss-light text-white px-2 py-0.5 text-xs rounded-full mr-1">${tag}</span>`).join('')}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex justify-between mt-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="showRecipeModal('${recipe.id}')" class="bg-moss-light hover:bg-leaf text-white font-bold py-1 px-3 rounded text-sm transition duration-150">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Megtekint / Szerkeszt
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="window.deleteRecipe('${recipe.id}')" class="text-red-500 hover:text-red-700 font-bold py-1 px-3 text-sm transition duration-150">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Tรถrlรฉs
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย }).join('')}
ย ย ย ย ย ย </div>
ย ย ย ย `;
ย ย }

ย ย // --- MODAL KEZELล FรGGVรNYEK ---

    window.closeModal = (id) => {
        const modal = document.getElementById(id);
        const container = document.getElementById('modal-container'); // Referencia a kontรฉnerre
    
        if (modal) modal.remove();
    
        container.innerHTML = ''; // Biztos, ami biztos

        // รJ LรPรS: Visszaadjuk a hidden osztรกlyt
        container.classList.add('hidden'); 
    };
ย ยย
ย ย // รltalรกnos modal alap
ย ย function createModal(id, title, bodyHtml, footerHtml = '', sizeClass = 'max-w-xl') {
ย ย ย ย const container = document.getElementById('modal-container');
ย ย ย ย const modal = document.createElement('div');
ย ย ย ย modal.id = id;
ย ย ย ย modal.className = 'modal-enter-from fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 transition-opacity duration-300';
ย ย ย ย modal.innerHTML = `
ย ย ย ย ย ย <div class="bg-white rounded-lg shadow-2xl ${sizeClass} w-full overflow-hidden" onclick="event.stopPropagation()">
ย ย ย ย ย ย ย ย <div class="bg-moss-dark text-white p-4 flex justify-between items-center">
ย ย ย ย ย ย ย ย ย ย <h3 class="text-xl font-bold">${title}</h3>
ย ย ย ย ย ย ย ย ย ย <button onclick="window.closeModal('${id}')" class="text-white hover:text-cream text-2xl font-light leading-none">
ย ย ย ย ย ย ย ย ย ย ย ย &times;
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="p-6 max-h-[80vh] overflow-y-auto">
ย ย ย ย ย ย ย ย ย ย ${bodyHtml}
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ${footerHtml ? `<div class="bg-gray-100 p-4 border-t flex justify-end">${footerHtml}</div>` : ''}
ย ย ย ย ย ย </div>
ย ย ย ย `;
ย ย ย ย container.appendChild(modal);
ย ย ย ย // Aktivรกlja a modal-enter-active รกllapotot a beรบszรกs animรกciรณhoz
ย ย ย ย setTimeout(() => modal.classList.remove('modal-enter-from'), 10);
ย ย }

ย ย // Kรฉszรฉtel modal
ย ย window.showPreparedMealModal = function() {
ย ย ย ย const modalId = 'prepared-meal-modal';
ย ย ย ย const body = `
ย ย ย ย ย ย <div class="space-y-4">
ย ย ย ย ย ย ย ย <input type="text" id="meal-name" placeholder="รtel neve (pl. Rรกntott hรบs, Gulyรกs)" class="w-full p-2 border border-gray-300 rounded">
ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย 
ย ย ย ย ย ย ย ย ย ย <label class="flex items-center space-x-2 text-gray-700">
ย ย ย ย ย ย ย ย ย ย ย ย <input type="checkbox" id="meal-requires-side" class="rounded text-leaf focus:ring-leaf">
ย ย ย ย ย ย ย ย ย ย ย ย <span>Kรถret szรผksรฉges hozzรก?</span>
ย ย ย ย ย ย ย ย ย ย </label>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <label class="block text-sm font-medium text-gray-700">Lejรกrati dรกtum (opcionรกlis):</label>
ย ย ย ย ย ย ย ย <input type="date" id="meal-expiry-date" class="w-full p-2 border border-gray-300 rounded">
ย ย ย ย ย ย </div>
ย ย ย ย `;
ย ย ย ย 
ย ย ย ย const footer = `
ย ย ย ย ย ย <button onclick="window.closeModal('${modalId}')" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded transition duration-150">Mรฉgsem</button>
ย ย ย ย ย ย <button onclick="handlePreparedMealSubmit()" class="bg-leaf hover:bg-moss-light text-white font-bold py-2 px-4 rounded transition duration-150 ml-2">Hozzรกadรกs</button>
ย ย ย ย `;

ย ย ย ย createModal(modalId, 'รj Kรฉszรฉtel Hozzรกadรกsa', body, footer);
ย ย };

ย ย // Funkciรณ a kรฉszรฉtel ลฑrlap kezelรฉsรฉhez
ย ย window.handlePreparedMealSubmit = function() {
ย ย ย ย const name = document.getElementById('meal-name').value;
ย ย ย ย const expiryDate = document.getElementById('meal-expiry-date').value;
ย ย ย ย const requiresSide = document.getElementById('meal-requires-side').checked;

ย ย ย ย if (!name.trim()) {
ย ย ย ย ย ย showAlert('Az รฉtel neve kรถtelezล!', 'error');
ย ย ย ย ย ย return;
ย ย ย ย }

ย ย ย ย window.addPreparedMeal(name, expiryDate, requiresSide);
ย ย ย ย window.closeModal('prepared-meal-modal');
ย ย };
    
ย ย // ... (A tobbi modal funkcio feltetelezve, hogy helyesen van beallitva a hianyzรณ rรฉszben) ...
    // Ezzel a javitassal az API hivasok mar helyes รบtvonalat fognak hasznalni.

    // Kezdeti megjelenรญtรฉs a betรถltรฉsi รกllapotban
    window.addEventListener('load', () => {
        switchTab(currentTab); // Betรถltjรผk az elsล fรผlet
    });
    
</script>
</body>
</html>
